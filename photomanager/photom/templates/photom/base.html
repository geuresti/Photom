<!DOCTYPE html>

{% load static %}

<html lang="en">
    <head>
        <link rel="stylesheet" href="{% static 'photom/style.css' %}">
        {% block style %} {% endblock %}
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %} Default Page Title {% endblock %}</title>

        <script src="https://kit.fontawesome.com/de872b992f.js" crossorigin="anonymous"></script>

    </head>
    
    <body>
        <div id="header">
            <a href="{% url 'index' %}">
                <img id="header-logo" src="{% static 'photom/SPI_logo.png'%}">
            </a>
            
            <div id="right-header">

                <div class="right-header-row">
                    {% if school %}
                    <div id="logged-in">
                        <p>
                            Logged in as: <b style="margin-left: 10px;"> {{ school.school_name }} </b>
                        </p>
                    </div>
                    {% endif %}

                    <div id="inbox-wrapper">
                        <div id="inbox-icon-wrapper">
                            <i id="inbox" class="fa-solid fa-inbox"></i>
                            <p id="unread-message-notification" class="hide"> * </p>
                        </div>
                        <div class="inbox-content">

                            <h2 id="inbox-note" style="text-align: center;"> Click on a notification to mark it as read </h2>

                            {% for notif in notifications %}

                                {% if notif.read %}
                                <div id="notification-{{notif.pk}}" class="notif" data-notifid="{{notif.pk}}">
                                    <h2> {{ notif.title }} </h2>
                                    <p> {{ notif.message }} </p>
                                    <div class="notif-footer">
                                        <p> Sent <i>{{ notif.send_date }}</i></p>
                                        <p id="remove-notification-{{notif.pk}}" class="remove-notification" data-notifid="{{notif.pk}}" style="color: red;"> X </p>
                                    </div>
                                </div>
                                {% else %}
                                <div id="notification-{{notif.pk}}" class="notif unread" data-notifid="{{notif.pk}}">
                                    <h2> {{ notif.title }} </h2>
                                    <p> {{ notif.message }} </p>
                                    <div class="notif-footer">
                                        <p> Sent <i>{{ notif.send_date }}</i></p>
                                        <p id="remove-notification-{{notif.pk}}" class="remove-notification" data-notifid="{{notif.pk}}" style="color: red;"> X </p>
                                    </div>
                                </div>
                                {% endif %}

                            {% endfor %}

                        </div>
                    </div>
                    
                    {% if school %}
                    <div>
                        <a id="account_settings_link" href="{% url 'account_settings' %}">
                            <div id="dropdown-hover">
                                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0 0 48 48">
                                    <path d="M39.139,26.282C38.426,25.759,38,24.919,38,24.034s0.426-1.725,1.138-2.247l3.294-2.415	c0.525-0.386,0.742-1.065,0.537-1.684c-0.848-2.548-2.189-4.872-3.987-6.909c-0.433-0.488-1.131-0.642-1.728-0.38l-3.709,1.631	c-0.808,0.356-1.749,0.305-2.516-0.138c-0.766-0.442-1.28-1.23-1.377-2.109l-0.446-4.072c-0.071-0.648-0.553-1.176-1.191-1.307	c-2.597-0.531-5.326-0.54-7.969-0.01c-0.642,0.129-1.125,0.657-1.196,1.308l-0.442,4.046c-0.097,0.88-0.611,1.668-1.379,2.11	c-0.766,0.442-1.704,0.495-2.515,0.138l-3.729-1.64c-0.592-0.262-1.292-0.11-1.725,0.377c-1.804,2.029-3.151,4.35-4.008,6.896	c-0.208,0.618,0.008,1.301,0.535,1.688l3.273,2.4C9.574,22.241,10,23.081,10,23.966s-0.426,1.725-1.138,2.247l-3.294,2.415	c-0.525,0.386-0.742,1.065-0.537,1.684c0.848,2.548,2.189,4.872,3.987,6.909c0.433,0.489,1.133,0.644,1.728,0.38l3.709-1.631	c0.808-0.356,1.748-0.305,2.516,0.138c0.766,0.442,1.28,1.23,1.377,2.109l0.446,4.072c0.071,0.648,0.553,1.176,1.191,1.307	C21.299,43.864,22.649,44,24,44c1.318,0,2.648-0.133,3.953-0.395c0.642-0.129,1.125-0.657,1.196-1.308l0.443-4.046	c0.097-0.88,0.611-1.668,1.379-2.11c0.766-0.441,1.705-0.493,2.515-0.138l3.729,1.64c0.594,0.263,1.292,0.111,1.725-0.377	c1.804-2.029,3.151-4.35,4.008-6.896c0.208-0.618-0.008-1.301-0.535-1.688L39.139,26.282z M24,31c-3.866,0-7-3.134-7-7s3.134-7,7-7	s7,3.134,7,7S27.866,31,24,31z"></path>
                                </svg>
            
                                <div class="dropdown-content">
                                    <a href="{% url 'account_settings' %}"> Settings </a>
                                    <a href="{% url 'about' %}"> About </a>
                                    <a href="{% url 'contact' %}"> Contact </a>
                                    <a href="{% url 'logout' %}"> Logout </a>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endif %}
                </div>

                <div id="shift-right" class="right-header-row">
                    <form action="{% url 'search_students' %}" method="post">
                        {% csrf_token %}
                        <input id="search-bar" type="text" name="searched" placeholder="Search...">
                        <button id="search-submit" type="submit"><i class="fa fa-search"></i></button>
                    </form> 
                </div>

            </div>
        </div>

        {% block content %}

        {% endblock %}

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script type="text/javascript">
        $('.remove-notification').click(function() {
            
            var notif_id;
            notif_id = $(this).attr("data-notifid");

            console.log(notif_id);

            $.ajax(
            {
                type:"GET",
                url: "/photom/hide_notification/" + notif_id + "/",
                data: {},
                success: function( data ) 
                {
                    $( '#notification-' + notif_id ).addClass('hide');
                }
            })
        });

        $('.notif').click(function() {

            var notif_id;
            notif_id = $(this).attr("data-notifid");

            console.log(notif_id);

            $.ajax(
            {
                type:"GET",
                url: "/photom/read_notification/" + notif_id + "/",
                data: {},
                success: function( data ) 
                {
                    $( '#notification-' + notif_id ).removeClass('unread');
                }
            })

            // I think it's still reading the "unread" class from this element
            update_inbox_unread_notification();

        });

        var inbox_note = document.getElementById("inbox-note");
        var inbox_empty = document.getElementsByClassName("notif");
        var unread_notification = document.getElementById("unread-message-notification");

        if (inbox_empty.length == 0) {
            console.log("no new notifications");
            inbox_note.innerText = "No new notifications";
            unread_notification.attributes.display = "none";
        }

        function update_inbox_unread_notification() {

            var notifications = document.getElementsByClassName("notif");
            var asdasd = document.getElementsByClassName("unread");

            var unread_messages = false

            if (asdasd.length == 0) {
                unread_notification.removeClass("hide");
                console.log("no more swagger");
            } else {
                console.log("swagger");
            }

            /*
            for (var i = 0; i < notifications.length; i++) {
                if (notifications[i].classList.contains("unread")) {
                    console.log("found an unread in ", notifications[i]);
                    unread_messages = true
                    break;
                } else {
                    notifications[i].attributes.display = "flex";
                }
            }

            if (unread_messages) {
                console.log("swagggerrr");
            } else {
                unread_notification.attributes.display = "none";
                console.log("no more swagger");
            }
            */
        }

        </script>
    </body>
</html>


